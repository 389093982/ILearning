<script language="javascript" type="text/javascript" src="/static/common/raty-2.8.0/lib/jquery.raty.js"></script>
<script type="text/javascript" src="/static/common/vue.min.js"></script>

<link href="/static/module/homemanage/courselist/courselist.css" rel="stylesheet">
<script type="text/javascript" src="/static/module/homemanage/courselist/courselist.js"></script>

<script src="/static/common/alert_info/js/classie.js"></script>
<script src="/static/common/alert_info/js/modalEffects.js"></script>

<!-- bootstrap模态框弹出效果 -->
<link href="/static/common/alert_info/css/component.css" rel="stylesheet">

<div id="course_list">
    <div v-cloak v-for="course in courses" style="border-bottom: 1px solid #b6acb7;padding: 15px;">
        <article>
            <header>
                <h4 style="color: #0e97dc;">课程名称：[[ course.course_name ]]
                    <span style="float: right;color: red;">[[ course.score ]]分</span><div class="star" style="float: right;" :score=" course.score "></div>
                </h4>
                <div style="clear:both;"></div>
            </header>
        </article>
        <section>
            <div style="float: left; margin-top:10px;width: 30%;">
                <img :src=" course.small_image " height="120" width="200" onerror="javascript:this.src='/static/img/a.png';"/><br>
                <a href="javascript:;" style="color: green;" class="md-trigger" :data-modal="'changeImage_' + course.id">换张图片</a>
            </div>
            <div style="float: left;width: 20%;">
                <p style="color:#f55e13;font-family: Arial;font-weight: 700;font-size: 16px;">浏览量：0</p>
            </div>
            <div style="float: left;width: 50%;">
                <p>课程作者：[[ course.course_author ]]</p>
                <p>课程内容类别：[[ course.course_type ]]</p>
                <p>课程内容子类别：[[ course.course_sub_type ]]</p>
                <p>课程简介：[[ course.course_short_desc ]]</p>
                <p>课程得分：[[ course.score ]]</p>
                <p>课程集数：[[ course.course_number ]]</p>
                <p>课程更新状态：[[ course.course_status ]]</p>
                <p><a href="javascript:;" style="color:#f55e13;font-family: Arial;font-weight: 700;"
                      class="md-trigger" :data-modal="'uploadvedio_' + course.id">上传/更新视频</a></p>
            </div>
            <div style="clear:both;"></div>
        </section>

        <!-- bootstrap模态框弹出效果,换张图片弹出 div -->
        <!-- 使用了 vue 的 v-bind 特性绑定属性 -->
        <div class="md-modal md-effect-1" :id="'changeImage_' + course.id">
            <div class="md-content" style="height: 400px;">
                <a href="#" class="md-close" style="float: right;margin: 10px;">X</a>
                <h3>上传/更新图片</h3>
                <div>
                    <img class="changeImage" :src=" course.small_image " width="200px" height="150px">
                    <input class="changeImageFile" type="file" name="changeImageFile" style="margin-top: 100px;"/>
                    <a href="javascript:;" :onclick="'changeImage(this, ' + course.id + ')'">提交</a>
                </div>

            </div>
        </div>
        <div class="md-overlay"></div>

        <div class="md-modal md-effect-1" :id="'uploadvedio_' + course.id">
            <div class="md-content" style="height: 400px;">
                <a href="#" class="md-close" style="float: right;margin: 10px;">X</a>
                <h3>上传/更新视频</h3>
                <div>
                    <p>课程名称:<strong>[[ course.course_name ]]</strong></p>
                    <p>选择更新的集数：
                        <ul id="course_number">
                            <li onclick="setCheck(this);"><a href="javascript:;" vedio_number="1">1</a></li>
                            <li onclick="setCheck(this);"><a href="javascript:;" vedio_number="2">2</a></li>
                            <li onclick="setCheck(this);"><a href="javascript:;" vedio_number="3">3</a></li>
                            <li onclick="setCheck(this);"><a href="javascript:;" vedio_number="4">4</a></li>
                            <li onclick="setCheck(this);"><a href="javascript:;" vedio_number="5">5</a></li>
                            <li onclick="setCheck(this);"><a href="javascript:;" vedio_number="6">6</a></li>
                            <li class="last" onclick="setCheck(this);"><a href="javascript:;" vedio_number="7">新一集(7)</a></li>
                        </ul>
                        <div style="clear: both;"></div>
                    </p>

                    <p>
                        <input name="vedio_number" type="hidden" value=""/>
                        <input name="vedio" type="file" class="uploadVedioFile"/>
                        <a href="javascript:;" :onclick="'uploadVedio(this, ' + course.id + ')'">提交</a>
                    </p>
                </div>
            </div>
        </div>
        <div class="md-overlay"></div>
    </div>
</div>

<style>
    #course_number li{float: left;margin: 5px;padding:0px;background-color: rgba(255, 148, 0, 0.38);width: 20px;
        height: 20px;text-align: center;}
    #course_number li.checked{background-color: #ff9400;}
    #course_number li.last{width: 70px}
    #course_number li a{text-decoration:none; color: #FFFFFF;font-size:12px;}
</style>

<script>
    function setCheck(liNode) {
        $(liNode).addClass("checked");
        $(liNode).siblings().removeClass("checked");
        // 填写表单 vedio_number
        var vedio_number = $(liNode).find("a").attr("vedio_number");
        $("input[name='vedio_number']").val(vedio_number);
    }
    
    function uploadVedio(node, courseId) {
        // jquery 对象转 dom 对象,再通过 files[0] 属性获取文件
        var uploadVedioFile = $(node).parent().find(".uploadVedioFile").get(0).files[0];
        var vedio_number = $("input[name='vedio_number']").val();
        var formData = new FormData();
        formData.append('id',courseId);
        formData.append('vedio_number',vedio_number);
        formData.append('uploadVedioFile', uploadVedioFile);

        $.ajax({
            url: "/course/newcourse/uploadvedio",
            type: "post",
            data: formData,
            contentType: false,
            processData: false,
            mimeType: "multipart/form-data",
            success: function (data) {
                alert(data);
                alert(JSON.parse(data));
                var obj = JSON.parse(data);
                if(obj.status == "SUCCESS"){
                    // 页面刷新
                    location.reload();
                }
            },
            error: function (data) {
                console.log(data);
            }
        });
    }
</script>



